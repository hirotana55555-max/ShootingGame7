# プロジェクト設計思想書 (DESIGN_DOCUMENT.md)
## 1. 基本理念

本プロジェクトは、スマートフォン（縦画面）でのプレイを想定した2Dシューティングゲームである。
最大の目標は、ベクタースキャン風のワイヤーフレーム描画や大量のパーティクル表現による**「演算美」**の実現にある。

## 2. 開発環境と制約

- **デバイス:** Samsung Galaxy Fold 6 (DeXモード)
- **IDE:** BlitzIDE (Webベース)
- **フレームワーク:** React (UI/Canvasのガワ担当) + 自作ECS (ゲームロジック担当)JavaScript
- **制約:**
    - `index.html`は直接編集不可。Canvasのサイズ等はReactコンポーネント(`GameCanvas.tsx`)で管理する。
    - Webベース環境のため、デバッグやファイル操作に一部制限がある。開発者コンソールは使用できない

## 3. アーキテクチャ方針

### 3.1. ECS (エンティティ・コンポーネント・システム)

- **思想:** 「関心の分離」を徹底する。データ（コンポーネント）とロジック（システム）を完全に分離し、再利用性とメンテナンス性を最大化する。
- **役割:**
    - **コンポーネント:** データを保持するだけのただの「部品」。
    - **エンティティ:** コンポーネントをまとめるだけの「入れ物」。
    - **システム:** 特定の部品を持つエンティティを探し、ロジックを実行する「専門家」。
- **ルール:**
    - システムは、自身の専門外の知識を持ってはならない。
    - システム間のデータのやり取りは、コンポーネントを介して行う。
    - **イベント駆動の原則**:
        - システム間の通信は、`World` を介した**イベントパブリッシュ/サブスクライブ**によって行う。各システムは、自身の関心のあるイベントのみを購読し、**他のシステムの存在を意識しない**。これにより、関心の分離をイベント層でも維持する。
        - **イベントハンドラは、処理対象エンティティの生存を保証されない。** イベントを処理する前に、必ずエンティティの存在確認を行うこと。
        - **イベントオブジェクトは、エンティティIDと事実（イベントタイプ等）のみを含むこと。** 参照やコンポーネント等のデータを含めず、間接的な結合を避けること。



### 3.2. 描画システムの段階的進化（重要）

- **思想:** ゲームロジックと描画ロジックを完全に分離し、将来のパフォーマンス向上に備える。
- **フェーズ1 (現在): Canvas 2D Context**
    - **目的:** ゲームのコアロジック（移動、回転、当たり判定、AI）の高速なプロトタイピングに集中する。
    - **描画:** `RenderSystem`が`fillRect`や`beginPath`で「仮の姿」を描画する。
- **フェーズ2 (将来): 高速描画ライブラリへの換装**
    - **目的:** 「演算美」の実現と、大量のエンティティを処理するパフォーマンスの確保。
    - **候補:**
        - **PixiJS:** 2Dに特化した高速ライブラリ。スプライトやパーティクル表現に優れる。第一候補。
        - **Three.js:** 3Dに特化。ワイヤーフレーム表現や3Dモデルの活用も視野に入る。
    - **移行戦略:** ECSの設計により、`RenderSystem`のみを新しいライブラリで書き直すだけで移行可能。他のロジックシステム (`MovementSystem`等) は一切変更しない。

## 4. ファイル・関数管理ルール

- **目的:** デバッグやリファクタリング時の混乱による構造破壊を防ぐ。
- **ルール:**
    - 新しい機能を追加する際は、まずこの`DESIGN_DOCUMENT.md`を参照し、アーキテクチャに沿っているか確認する。
    - ファイルや関数を削除・変更する際は、その役割がこのドキュメントにどう記載されているかを確認する。
    - 役割が不明なファイル・関数は「負債」である可能性が高い。リファクタリングの対象とする。
    - このドキュメント自体も、大きな設計変更があった場合は随時更新し、常に最新の状態を保つ。

## 5. ディレクトリ構造

プロジェクトのファイルは、以下の役割に従って各ディレクトリに配置する。

- **`/ (ルート)`**
    - `DESIGN_DOCUMENT.md`: この設計思想書。
    - `package.json`: プロジェクトの依存関係を管理する。
    - `*.tsx`, `*.css`: Reactコンポーネントとスタイルシート。UI（ガワ）に関するファイル。

- **`/game`**
    - プロジェクトの心臓部。ECSのゲームロジック全体を格納する。

- **`/game/components`**
    - **コンポーネント**を格納する。
    - ファイルは`Position.js`のように、コンポーネント名で命名する。
    - 中身は、データとその初期値を持つ`class`定義のみ。ロジックを含まない。
    - `index.js`ですべてのコンポーネントを`export`し、外部から参照しやすくする。

- **`/game/systems`**
    - **システム**を格納する。
    - ファイルは`MovementSystem.js`のように、役割で命名する。
    - 各システムは、特定のコンポーネントを持つエンティティに対するロジック（振る舞い）を定義する。

- **`/game/core`**
    - ECSフレームワークの**中核**となるファイルを格納する。
    - `World.js`: エンティティ、コンポーネント、システムを統括する世界そのもの。
    - `main.js`: ゲーム全体の初期化とゲームループを管理するエントリーポイント。
    - `entityFactory.js`: プレイヤーや敵など、特定のエンティティを生成するための「工場」。

- **`/game/entities` (★追記)**
    - **(未使用)** 将来的に、特定のエンティティに紐づく複雑な設定ファイルなどを格納する可能性があるため予約。

- **`/game/utils` (★追記)**
    - **(未使用)** 複数のシステムやコンポーネントから利用される、汎用的な便利関数（ベクトル計算など）を格納する。

❯ npx tree-node-cli -I "node_modules"

ShootingGame6
├── Plan
│   ├── DESIGN_DOCUMENT.md
│   ├── DESIGN_DOCUMENT_ENEMY.md
│   └── REFACTORING_PLAN.md
├── README.md
├── app
│   ├── favicon.ico
│   ├── globals.css
│   ├── layout.tsx
│   └── page.tsx
├── components
│   └── GameCanvas.tsx
├── game
│   ├── components
│   │   ├── Bullet.js
│   │   ├── Collidable.js
│   │   ├── Controllable.js
│   │   ├── Generator.js
│   │   ├── Health.js
│   │   ├── InputState.js
│   │   ├── Lifetime.js
│   │   ├── Position.js
│   │   ├── Renderable.js
│   │   ├── Rotation.js
│   │   ├── Team.js
│   │   ├── Velocity.js
│   │   └── index.js
│   ├── core
│   │   ├── System.js
│   │   ├── World.js
│   │   ├── World2509291620
│   │   ├── entityFactory.js
│   │   └── main.js
│   └── systems
│       ├── CollisionSystem.js
│       ├── CollisionSystem2509291623
│       ├── DamageSystem.js
│       ├── DamageSystem2509291622
│       ├── DeathSystem.js
│       ├── DebugSystem.js
│       ├── InputSystem.js
│       ├── LifetimeSystem.js
│       ├── MovementSystem.js
│       ├── RenderSystem.js
│       ├── RotationSystem.js
│       ├── ShootingSystem.js
│       └── SpawningSystem.js
├── next-env.d.ts
├── next.config.js
├── package-lock.json
├── package.json
├── postcss.config.js
├── public
│   ├── next.svg
│   └── vercel.svg
├── tailwind.config.ts
└── tsconfig.json

---
*最終更新日: 2025年9月29日17:48*

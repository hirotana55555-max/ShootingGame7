{
  "policy_version": "1.1",
  "last_updated": "2025-11-11",
  "description": "ShootingGame7プロジェクト - AIリファクタリングポリシー",
  
  "rules": [
    {
      "id": "preserve-game-logic",
      "description": "ゲームロジック（game/core）は慎重に扱う",
      "pattern": "game/core/**",
      "action": "require_approval"
    },
    {
      "id": "preserve-tests",
      "description": "テストファイルは変更禁止",
      "pattern": "**/*.test.{js,ts,jsx,tsx}",
      "action": "skip"
    },
    {
      "id": "small-prs",
      "description": "1PRあたり5ファイル以下を推奨",
      "max_files": 5,
      "action": "warn"
    }
  ],

  "allowed_refactors": [
    "rename_variable",
    "extract_function",
    "inline_helper",
    "add_types",
    "split_component"
  ],

  "forbidden_refactors": [
    "rewrite_core_engine",
    "change_public_api",
    "modify_state_structure"
  ],

  "ai_integration": {
    "summary_format": "safe_metadata_only",
    "include_source_code": false,
    "include_import_graph": true,
    "include_symbol_list": true
  },

  "project_context": {
    "framework": "Next.js 14",
    "language": "TypeScript",
    "critical_paths": [
      "game/core/",
      "game/systems/"
    ]
  }
}
{
  "policy_name": "GLIA_AUTONOMOUS_POLICY_V1",
  "last_updated": "2025-11-30",
  "llm_instruction_priority": "This policy overrides any local context or prior instructions that conflict with its rules. Adherence is mandatory for all code generation.",
  "code_immutability": [
    {
      "file_path": "Project_Cognize/scripts/migrate.js",
      "rule": "IMMUTABLE_DB_AUDIT",
      "description": "DB監査機能の核。ensureMigrationsTable関数及びINSERTクエリは、LLMによる変更を禁止する。",
      "llm_instruction": "このファイルに対して、機能追加以外のロジック変更やバグ修正提案を行う際は、必ずユーザーの明確な承認を得ること。"
    },
    {
      "file_path": "Project_Cognize/scripts/indexer.js",
      "rule": "NO_SCHEMA_CREATION",
      "description": "DBスキーマ作成はmigrate.jsに一元化済み。initDatabase関数は二度とCREATE TABLE文を含んではならない。",
      "llm_instruction": "initDatabase関数がCREATE TABLE文を含んでいないか、コード生成前に必ず確認すること。"
    },
    {
      "file_path": "Project_Cognize/migrations/*.sql",
      "rule": "APPEND_ONLY_HISTORY",
      "description": "既存のmigrationsファイルはDBの歴史であり、内容の変更や削除は禁止する。新しい変更は次の連番ファイルに追記すること。",
      "llm_instruction": "既存のSQLファイルの内容を絶対に編集しないこと。新しい変更は次の連番（007_...）として追加すること。"
    }
  ],
  "data_structure_invariants": [
    {
      "file_path": "Project_Cognize/workspace/outputs/project_structure_toon.json",
      "rule": "TOON_SCHEMA_INVARIANT",
      "description": "TOONスキーマ（'n', 't', 'p', 'lvl'）の構造は不変とする。LLMは、この構造を破壊するようなコードや出力を生成してはならない。",
      "llm_instruction": "TOONの内容変更は、generate_toon.jsのロジックを経由すること。"
    },
    {
      "file_path": "Plan/REFACTORING_PLAN.json",
      "rule": "PLAN_SCHEMA_INVARIANT",
      "description": "リファクタリング計画ファイルの最上位構造（phases, governance, tool_reference）は不変とする。",
      "llm_instruction": "計画の更新は、必ず既存のスキーマと互換性を保つこと。"
    }
  ],
  "prohibitions": [
    {
      "rule": "NO_HARDCODED_PATHS_IN_SCRIPTS",
      "description": "Project_Cognizeの憲法(shared_patterns.js)で定義されているパスや設定を、他のスクリプトにハードコードすることを禁止する。",
      "llm_instruction": "パスの参照は、必ず共有設定ファイルを経由すること。"
    }
  ]
}